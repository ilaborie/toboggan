#!/usr/bin/env bash
#MISE description="Run iOS application tests to verify UniFFI integration"

set -eu

XCODE_PROJECT="TobogganApp"

echo "üì± Running iOS tests..."

# Navigate to TobogganApp directory
if [ -d "$XCODE_PROJECT" ]; then
    cd "$XCODE_PROJECT"
    
    PROJECT_PATH="$(pwd)/$XCODE_PROJECT.xcodeproj"
    
    echo "üîç Running iOS unit tests to verify UniFFI integration..."
    echo "  üìÅ Project: $PROJECT_PATH"
    
    # Check if xcodebuild is available
    if command -v xcodebuild >/dev/null 2>&1; then
        echo "üß™ Running iOS unit tests..."
        if xcodebuild test -project "$XCODE_PROJECT.xcodeproj" -scheme "$XCODE_PROJECT" -destination 'platform=iOS Simulator,name=iPhone 16' -quiet; then
            echo "‚úÖ iOS tests passed!"
        else
            echo "‚ö†Ô∏è  iOS tests failed or simulator unavailable"
            echo "üí° Manual test command:"
            echo "  xcodebuild test -project $XCODE_PROJECT.xcodeproj -scheme $XCODE_PROJECT -destination 'platform=iOS Simulator,name=iPhone 16'"
        fi
    else
        echo "‚ö†Ô∏è  xcodebuild not found, skipping iOS tests"
        echo "üí° To run tests manually:"
        echo "  xcodebuild test -project $XCODE_PROJECT.xcodeproj -scheme $XCODE_PROJECT -destination 'platform=iOS Simulator,name=iPhone 16'"
    fi
    
    cd ..
else
    echo "‚ÑπÔ∏è  No TobogganApp directory found, skipping iOS tests"
fi

echo "‚úÖ All iOS tests completed!"